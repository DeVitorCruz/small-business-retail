<div class="variations-container">
    <h2>Manage Variations</h2>

    <mat-form-field appearance="fill" class="ful-width">
        <mat-label>Select Subcategory</mat-label>
        <mat-select [(ngModel)]="selectedSubCategory" (selectionChange)="onSubCategoryChange($event)">
            <mat-option *ngFor="let subCategory of this.subCategories" [value]="subCategory.id">
                {{ subCategory.name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <form action="" (ngSubmit)="addNewVariation()" *ngIf="selectedSubCategory">

        <mat-form-field appearance="fill" class="ful-width">
            <mat-label>Select Variation Type</mat-label>
            <mat-select [(ngModel)]="selectedVariationType" name="variationType" (selectionChange)="onVariationTypeChange($event)">
                <mat-option *ngFor="let varitionType of this.variationTypes" [value]="varitionType.id">
                    {{ varitionType.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="ful-width">
            <mat-label>New Variation Value</mat-label>
            <mat-chip-grid #chipGrid>
                <mat-chip-row *ngFor="let value of this.variationValues" (removed)="removeValue(value)">
                    {{ value }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-row>
                <input
                    matInput
                    placeholder="New variation value"
                    type="text"
                    [(ngModel)]="newVariationValue"
                    name="newVariationValue"
                    [matChipInputFor]="chipGrid"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                    [matChipInputAddOnBlur]="true"
                    (matChipInputTokenEnd)="addValue($event)"
                    required
                />
            </mat-chip-grid>
        </mat-form-field>

        <div class="actions-buttons">
            <button mat-raised-button color="primary" type="submit">Add Variation</button>
        </div>

    </form>

    <h3 *ngIf="variations.length">Current Variations</h3>
    
    <table mat-table [dataSource]="transformedVariations" class="mat-elevation-z8" *ngIf="variationTypes.length">

        <ng-contianer matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let transformedVariation">{{ transformedVariation.type_name }}</td>
        </ng-contianer>

        <ng-contianer matColumnDef="value">
            <th mat-header-cell *matHeaderCellDef>Value</th>
            <td mat-cell *matCellDef="let transformedVariation">{{ transformedVariation.value }}</td>
        </ng-contianer>
        
        <ng-contianer matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let transformedVariation">
              <button mat-icon-button (click)="openVariationDialog(transformedVariation)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteVariation(transformedVariation.variation_id)">
                <mat-icon>cancel</mat-icon>
              </button>
            </td>
        </ng-contianer>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

</div>
