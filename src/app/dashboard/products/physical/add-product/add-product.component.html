<div class="form-container">
    <form [formGroup]="productForm" action="" (ngSubmit)="onSubmit()">

        <div class="product-section">

            <div class="preview-image">
                <img *ngIf="productImages[0]?.image_path" [src]="productImages[0].image_path" alt="Preview Image" />
                <div *ngIf="!productImages[0]?.image_path" class="placeholder">No Image</div>
            </div>

            <div class="image-slots">
                <div *ngFor="let image of this.productImages; let i = index" class="image-slot">
                    <div class="slot-content" (click)="openImageDialog(i)">
                        <img *ngIf="image?.image_path" [src]="image.image_path" alt="Small Image" />
                        <mat-icon *ngIf="!image?.image_path">add</mat-icon>
                    </div>
                </div>
            </div>

        </div>


        <mat-card>
            <mat-card-title>Add Product</mat-card-title>
            <mat-card-content>

                <mat-form-field appearance="outline">
                    <mat-label>Product Name</mat-label>
                    <input matInput formControlName="name" type="text" required />
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Price</mat-label>
                    <input matInput formControlName="price" min="0" type="number" required />
                </mat-form-field>
                
                <mat-form-field appearance="outline">
                    <mat-label>Quantity</mat-label>
                    <input matInput formControlName="quantity" min="0" type="number" required />
                </mat-form-field>
                
                <mat-form-field appearance="outline">
                    <mat-label>Description</mat-label>
                    <input matInput formControlName="description" type="text" />
                </mat-form-field>
                
                <mat-form-field appearance="outline">
                    <mat-label>Product Code</mat-label>
                    <input matInput formControlName="product_code" type="text" required />
                </mat-form-field>

            </mat-card-content>
        </mat-card>


        <mat-card>
            <mat-card-title>Sub category and Variations</mat-card-title>
            <mat-card-content>

                <mat-form-field appearance="outline">
                    <mat-label>SubCategory</mat-label>
                    <mat-select formControlName="sub_category_id" (selectionChange)="onSubCategoryChange($event.value);" required>
                        <mat-option *ngFor="let subCategory of this.subCategories" [value]="subCategory.id">
                            {{ subCategory.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <div *ngFor="let variationType of this.variationsTypes">
                    <mat-form-field appearance="outline" class="variation-selector">
                        <mat-label>{{ variationType.name }}</mat-label>
                        <mat-select [formControl]="variationType.control" required>
                            <mat-option *ngFor="let value of variationType.variations" [value]="value.id">
                                {{ value.value }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

            </mat-card-content>
        </mat-card>

        
        <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="!productForm.valid">Submit</button>
        </div>

    </form>
</div>
